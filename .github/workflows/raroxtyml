name: Tailscale-RDP
on: workflow_dispatch

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TS_AUTHKEY }}

      - name: Enable RDP
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 1

      - name: Set Password
        run: net user runneradmin MyStrongPassword123!

      - name: Keep Alive
        run: |
          Write-Host "RDP is ready! Connect to the Tailscale IP of this runner."
          Write-Host "Username: runneradmin"
          Write-Host "Password: MyStrongPassword123!"
          Start-Sleep -Seconds 21600 # Keeps the session active for 6 hours
